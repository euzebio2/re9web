(function($) {
$.fn.lavaLamp = function(o) {
    o = $.extend({ fx: "linear", speed: 300, click: function(){} }, o || {});

    return this.each(function() {
        var me = $(this), noop = function(){},
            $lava = $('<li class="lava"><div class="left"></div></li>').appendTo(me),
            $li = $("li", this), curr = $("li", this)[0] || $($li[0])[0];

        setCurr(curr);

        $li.not(".lava").hover(function() {
            move(this);
        }, noop);

        $(this).hover(noop, function() {
            move(curr);
        });

        $li.click(function(e) {
            setCurr(this);
            return o.click.apply(this, [e, this]);
        });

        function setCurr(el) {
        	var width = jQuery(el).width() / 2;
            $lava.css({ "left": el.offsetLeft + width +"px"});
            curr = el;
        };

        function move(el) {
        	var width = jQuery(el).width() / 2;
            $lava.each(function() {
                $.dequeue(this, "fx"); }
            ).animate({
                left: el.offsetLeft + width
            }, o.speed, o.fx);
        };

    });
};
})(jQuery);